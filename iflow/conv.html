<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <script src="js/go.js"></script>
    <script src="js/icons.js"></script>
    <script src="js/flow-desinger.js"></script>
    <script src="js/flow-display.js"></script>

    <link rel="stylesheet" href="js/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="js/codemirror/monokai.css">
    <link rel="stylesheet" href="js/codemirror/addon/dialog/dialog.css">
    <script src="js/codemirror/lib/codemirror.js"></script>
    <script src="js/codemirror/lib/diff_match_patch.js"></script>
    <script src="js/codemirror/addon/edit/matchbrackets.js"></script>
    <script src="js/codemirror/addon/edit/closebrackets.js"></script>
    <script src="js/codemirror/addon/scroll/annotatescrollbar.js"></script>
    <script src="js/codemirror/addon/search/matchesonscrollbar.js"></script>
    <script src="js/codemirror/addon/search/searchcursor.js"></script>
    <script src="js/codemirror/addon/search/match-highlighter.js"></script>
    <script src="js/codemirror/addon/comment/comment.js"></script>
    <script src="js/codemirror/addon/dialog/dialog.js"></script>
    <script src="js/codemirror/groovy.js"></script>
    <link rel="stylesheet" href="js/codemirror/addon/hint/show-hint.css">
    <script src="js/codemirror/addon/hint/show-hint.js"></script>
    <script src="js/codemirror/addon/hint/anyword-hint.js"></script>
    <link rel="stylesheet" href="js/codemirror/addon/merge/merge.css">
    <script src="js/codemirror/addon/merge/merge.js"></script>
    <script src="js/codemirror/addon/selection/active-line.js"></script>
    <script src="js/codemirror/addon/selection/mark-selection.js"></script>

    <link rel="stylesheet" href="js/codemirror/addon/fold/foldgutter.css"/>
    <script src="js/codemirror/addon/fold/foldcode.js"></script>
    <script src="js/codemirror/addon/fold/foldgutter.js"></script>
    <script src="js/codemirror/addon/fold/brace-fold.js"></script>
    <script src="js/codemirror/addon/fold/comment-fold.js"></script>

    <script src="js/codemirror/javascript.js"></script>
    <script src="js/codemirror/jsonlint.js"></script>
    <link rel="stylesheet" href="js/codemirror/addon/lint/lint.css">
    <script src="js/codemirror/addon/lint/lint.js"></script>
    <script src="js/codemirror/addon/lint/javascript-lint.js"></script>
    <script src="js/codemirror/addon/lint/json-lint.js"></script>

    <style type="text/css">
      
      .design-container{display: flex;}
      .design-tool{width: 100px; margin-right: 20px;}
      .design-area{flex:1;}
      .cavas-div{border: solid 2px #444;border-radius: 4px;}
    </style>
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>iflow</title>
  </head>
  <body>
    <script type="text/javascript">
      
      window.flowScript={
  "code": "timi_flow",
  "name": "店小蜜问答流程",
  "nodes": {
    "1": {
      "conditions": [
        {
          "actions": [
            {
              "action": "FINISH"
            }
          ],
          "express": "#root.userData.get('unavailable') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "51"
            }
          ],
          "express": "#root.userData.get('IntentionQuery') != null && #root.userData.get('IntentionQuery').getEventType().name() != 'TEXT'",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "46"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 1,
      "instanceCode": "request_parse",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.RequestParseModule",
      "signal": 1
    },
    "2": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "45"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 2,
      "instanceCode": "intention",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.IntentionInvokeModule",
      "signal": 1
    },
    "3": {
      "conditions": [
        {
          "actions": [
            {
              "action": "FINISH"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 3,
      "instanceCode": "scene_inquery",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SceneInqueryModule",
      "signal": 1
    },
    "4": {
      "conditions": [
        {
           "actions":[
             {
                "action":"NEXT",
                "express":"51"
             }
           ],
                "express":"#root.userData.remove('ProductSearchFlag') != null && #root.userData.get('IntentionQuery') != null && #root.userData.get('IntentionQuery').getEventType().name() != 'TEXT'",
                "type":"ognl"
         },
         {
            "actions":[
              {
                 "action":"NEXT",
                 "express":"46"
               }
           ],
                  "express":"#root.userData.remove('ProductSearchFlag') != null",
                  "type":"ognl"
         },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 4,
      "instanceCode": "card",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.CardModule",
      "signal": 1
    },
    "5": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "43"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "6"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 5,
      "instanceCode": "keywords",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.KeywordsModule",
      "signal": 1
    },
    "6": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "24"
            }
          ],
          "express": "#root.userData.get('isvAppKey') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "8"
            }
          ],
          "express": "#root.userData.get('isSizeCondition') == true",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "9"
            }
          ],
          "express": "#root.userData.get('isNeedConfirmProduct') == true",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "10"
            }
          ],
          "express": "#root.userData.get('isActivity') == true",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "24"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 6,
      "instanceCode": "guide_sop",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.GuideSopModule",
      "signal": 1
    },
    "8": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "38"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 8,
      "instanceCode": "size",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SizeModule",
      "signal": 1
    },
    "9": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 9,
      "instanceCode": "product_confirm",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ProductConfirmModule",
      "signal": 1
    },
    "10": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "24"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 10,
      "instanceCode": "activity",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ActivityModule",
      "signal": 1
    },
    "11": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "36"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 11,
      "instanceCode": "general",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.GeneralModule",
      "signal": 1
    },
    "13": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "37"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 13,
      "instanceCode": "custom",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.CustomModule",
      "signal": 1
    },
    "15": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null && #root.userData.get('Answer').getResultCode().code != 2",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "44"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 15,
      "instanceCode": "talk",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.TalkModule",
      "signal": 1
    },
    "16": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null && #root.userData.get('Answer').getResultCode().code != 2",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "32"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 16,
      "instanceCode": "question_recommend",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.QuestionRecommendModule",
      "signal": 1
    },
    "17": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "29"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 17,
      "instanceCode": "product_recommend",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ProductRecommendModule",
      "signal": 1
    },
    "20": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "43"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 20,
      "instanceCode": "nick",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.NickModule",
      "signal": 1
    },
    "21": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": 22
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 21,
      "instanceCode": "answer_parse",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.AnswerParseModule",
      "signal": 1
    },
    "22": {
      "conditions": [
        {
          "actions": [
            {
              "action": "FINISH"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 22,
      "instanceCode": "update_context",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.UpdateContextModule",
      "signal": 1
    },
    "23": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "4"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 23,
      "instanceCode": "sop",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SopModule",
      "signal": 1
    },
    "24": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "25"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 24,
      "instanceCode": "sop",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SopModule",
      "signal": 1
    },
    "25": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "21"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "35"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 25,
      "instanceCode": "dialog_studio",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.DialogStudioModule",
      "signal": 1
    },
    "28": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "20"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 28,
      "instanceCode": "sop_card",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SopCardAnswerModule",
      "signal": 1
    },
    "29": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "28"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 29,
      "instanceCode": "isg",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.IntegratedShoppingGuideModule",
      "signal": 1
    },
    "30": {
      "conditions": [
        {
            "actions":[
                {"action":"NEXT","express":"6"}
            ],
            "express":"#root.userData.get('isvAppKey') != null",
            "type":"ognl"
        },
        {
              "actions":[
                {"action":"NEXT","express":"21"}
              ],
               "express":"#root.userData.get('Answer') != null",
               "type":"ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "5"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 30,
      "instanceCode": "imageHandle",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ImageHandleModule",
      "signal": 1
    },
    "32": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 32,
      "instanceCode": "modifyChat",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ModifyChatModule",
      "signal": 1
    },
    "33": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null && #root.userData.get('Answer').getResultCode().code != 2",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "15"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 33,
      "instanceCode": "bigPromotion",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.BigPromotionModule",
      "signal": 1
    },
    "34": {
      "conditions": [
        {
          "actions": [
            {
              "action": "FINISH"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "1"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 34,
      "instanceCode": "blockChain",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.BlockChainModule",
      "signal": 1
    },
    "35": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "21"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "11"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 35,
      "instanceCode": "algorithmIsv",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.AlgorithmIsvModule",
      "signal": 1
    },
    "36": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "43"
            }
          ],
          "express": "#root.userData.get('forceToPerson') != null",
          "type": "ognl"
        },
        {
           "actions":[
             {
               "action":"NEXT",
               "express":"51"
             }
           ],
               "express":"#root.userData.remove('ProductSearchFlag') != null && #root.userData.get('IntentionQuery') != null && #root.userData.get('IntentionQuery').getEventType().name() != 'TEXT'",
               "type":"ognl"
         },
         {
            "actions":[
              {
                "action":"NEXT",
                "express":"46"
               }
             ],
                "express":"#root.userData.remove('ProductSearchFlag') != null",
                "type":"ognl"
          },
          {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "#root.userData.get('Answer') == null || #root.userData.get('Answer').getResultCode().code != 1",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 36,
      "instanceCode": "renderTemplate",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.RenderTemplateModule",
      "signal": 1
    },
    "37": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null && #root.userData.get('Answer').getResultCode().code != 2",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "33"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 37,
      "instanceCode": "renderTemplate",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.RenderTemplateModule",
      "signal": 1
    },
    "38": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "13"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 38,
      "instanceCode": "renderTemplate",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.RenderTemplateModule",
      "signal": 1
    },
    "43": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "21"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 43,
      "instanceCode": "imageMrc",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ImageMrcHandleModule",
      "signal": 1
    },
    "44": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "17"
            }
          ],
          "express": "#root.userData.get('Answer') != null && #root.userData.get('Answer').getResultCode().code != 2",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "16"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 44,
      "instanceCode": "imageMrc",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.ImageMrcHandleModule",
      "signal": 1
    },
    "45": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "21"
            }
          ],
          "express": "#root.userData.get('Answer') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "3"
            }
          ],
          "express": "#root.userData.get('sceneInquery') == true",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "23"
            }
          ],
          "express": "#root.userData.get('cardQuestionId') != null && #root.userData.get('cardScene') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "4"
            }
          ],
          "express": "#root.userData.get('cardQuestionId') != null",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "30"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 45,
      "instanceCode": "sceneRengong",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.SceneRengongModule",
      "signal": 1
    },
    "46": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "47"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 46,
      "instanceCode": "preIntent",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.PreIntentHandleModule",
      "signal": 1
    },
    "47": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "48"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 47,
      "instanceCode": "productParse",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.ProductParseHandleModule",
      "signal": 1
    },
    "48": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "49"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 48,
      "instanceCode": "orderParse",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.OrderParseHandleModule",
      "signal": 1
    },
    "49": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "50"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 49,
      "instanceCode": "sceneParse",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.SceneParseHandleModule",
      "signal": 1
    },
    "50": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "52"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 50,
      "instanceCode": "shopActivity",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.ShopActivityHandleModule",
      "signal": 1
    },
    "51": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "46"
            }
          ],
          "express": "#root.userData.get('IntentWhenText') == true",
          "type": "ognl"
        },
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "52"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 51,
      "instanceCode": "clickIntent",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.ClickIntentHandleModule",
      "signal": 1
    },
    "52": {
      "conditions": [
        {
          "actions": [
            {
              "action": "NEXT",
              "express": "45"
            }
          ],
          "express": "default",
          "type": "default"
        }
      ],
      "id": 52,
      "instanceCode": "resultIntent",
      "joinPoint": false,
      "moduleName": "alibee-shop:com.alibee.shop.biz.module.intent.ResultIntentHandleModule",
      "signal": 1
    }
  },
  "startNode": 34,
  "status": "ONLINE",
  "timeout": 1000,
  "version": "1.0.0"
};
    </script>
    <div>
      <div class="design-container">
        <div class="design-tool">
          <div class="cavas-div" id="myPaletteDiv" style="height: 700px"></div>
        </div>
        <div class="design-area">
          <div class="cavas-div" id="myFlowDesignerDiv" style="height: 700px"></div>
        </div>
      </div>

    </div>
    <script type="text/javascript">
      window.onFlowDialogObjectContextClicked=function(ev){// 图元素右击事件
        if(!ev||!ev.subject)return;
        let node = ev.subject.part;
        if(node&&node.data&&node.data.text&&node.data.category === 'Comment'){// 注释右击
          let targetComment=node.data.text.trim();
        }
      };
      if(!window.myDesigner){
        window.myDesigner = new window.FlowDesigner('myFlowDesignerDiv');
        window.myDesigner.initToolbar('myPaletteDiv');
      }
      let flowTpl=window.localStorage.getItem('flowScript-'+window.flowScript.code);
      if(window.location.hash=='#new'){
        flowTpl=JSON.stringify(convAiEngineFlow2GoFlow(window.flowScript), null ,2);
      }
      window.myDesigner.displayFlow(flowTpl,1);
      window.onFlowDiagramModified=(isModified, e)=>{
        if(e.diagram==window.myDesigner.getDesigner()){
          window.localStorage.setItem('flowScript-'+window.flowScript.code,window.myDesigner.getFlowData());
        }
      }

      function convAiEngineFlow2GoFlow(scriptObj){
        let startNodeKey=+scriptObj.startNode;
        let nodes=scriptObj.nodes;
        let nodeDataArray=[{key:-1,text:'开始',nodeType:0,figure:'Circle',fill: "#ccccff"},{
          "key": -99,
          "text": "成功",fill: "#00DD00",
          "nodeType": 1,figure:'Circle'
        }],linkDataArray=[{
          "from": -1,
          "to": startNodeKey,
          "text": "成功",
          "condition": "success"
        },];
        for(let key in nodes){
          let node=nodes[key];
          let nodeData={key:key,text:node.moduleName.substring(node.moduleName.lastIndexOf('.')+1),className:node.moduleName};
          nodeDataArray.push(nodeData);
          if(node.conditions){
            for(let cond of node.conditions){
              if(cond.actions){
                let action=cond.actions[0];
                let to=action.express;
                if(action.action=='FINISH'){
                  to=-99;
                }
                let link={from:+key,to:to,text:'',condition:cond.express};
                linkDataArray.push(link);
              }
            }
          }
        }
        //console.log(nodeDataArray,linkDataArray);
        return {nodeDataArray,linkDataArray};
      }
      
    </script>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
